@model List<Product>;
@{
    ViewData["Title"] = "Table Page";
    Layout = "~/Views/Table/_Layout.cshtml";
}


<div class="text-center">
    <h1 class="display-4">Store</h1>


    <div class="myTable">
        <table id = "table_1">

            <tr>
                <th>
                    ID
                    <a class="btn btn-primary, col-lg-3" asp-area="" asp-controller="Table" asp-action="AddProduct">
                        <span style="color: green; font-size: 24px; font-weight: bold;">+</span>
                    </a>
                </th>
                <th>Название</th>
                <th>Описание</th>
                <th>Цена шт.</th>
                <th>Количество</th>
                <th>Действие<br>(with form)</th>
                <th>Действие<br>(with JS)</th>
                <th>Действие<br>(with fetch)</th>
            </tr>

            @foreach (var product in Model)
            {
                var id = product.Id;
                <tr id="row_@id">
                    <td style="font-style: italic">@product.Id</td>
                    <td>
                        <div id="name_@id">@product.Name</div>
                    </td>
                    <td>
                        <div id="description_@id">@product.Description</div>
                    </td>
                    <td>
                        <div id="price_@id">@product.Price р.</div>
                    </td>
                    <td>
                        <div id="amount_@id">@product.Amount</div>
                    </td>
                    <td>
                        <a class="btn btn-primary, col-lg-3" asp-area="" asp-controller="Table"
                           asp-action="UpdateProduct"asp-route-productId="@product.Id">
                            ✎
                        </a>
                        <a class="btn btn-primary, col-lg-3" asp-area="" asp-controller="Table"
                           asp-action="DeleteProduct"asp-route-productId="@product.Id">
                            ❌
                        </a>
                    </td>
                    <td>
                        <button id="edit_button_@id" onclick="onEditButton(@id)">✎</button>
                        <button id="delete_button_@id" onclick="onDeleteClick(@id)">❌</button>
                    </td>
                    <td>
                        <button onclick="onCreateClick()">➕</button>
                        <button onclick="onEditClick_(@id)">✎</button>
                        <button onclick="onDeleteClick(@id)">❌</button>
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

@*Using fetch*@
<script>
    async function onDeleteClick(id){
        let response = await fetch(`delete-${id}`);
        if (response.ok){
             let rowToDelete = document.getElementById(`row_${id}`)
             rowToDelete.remove();
        } else {
            alert("Ошибка: " + response.status);
        }
    }
    
    async function onCreateClick(){
       
       //let lastRowID = document.lastChild("tbody");
       //alert(lastRowID);
       //let lastRow = document.getElementById("lastRowID");
        
        
       let product  = {
             Name: 'Product Name',
             Description: 'Product Description',
             Price: 10,
             Amount: 100};
       
       
      await fetch('add-product-json', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify(product)
       })
    }

</script>

@*Using only JS*@
<script>  
   
    function onEditButton(rowID)
    {
        let row = document.getElementById(`row_${rowID}`);
        let cell = row.getElementsByTagName('td');
        
        for (let cellID = 1; cellID < 5; cellID++)
        {
            addInputAndHideText(cell[cellID], rowID, cellID);
        }
        
        ReplaceEditButtons('edit_button', rowID, 'OK');
        ReplaceEditButtons('delete_button', rowID, 'Cancel');
    }
    
    function addInputAndHideText(cell, rowID, cellID)
    {
        let input = document.createElement("input");
        input.id = `input_row_${rowID}_cell_${cellID}`;
        input.value = cell.innerText;
        cell.appendChild(input);
        cell.querySelector('div').style.display = 'none';
    }
    
    function ReplaceEditButtons(route, id, name)
    {
        let button = document.getElementById(`${route}_${id}`);
        let newButton = document.createElement("button");
        newButton.textContent = name;
        newButton.id = `${name}_button_${id}`;
        
        name === "OK" ? newButton.onclick = () => confirm(id, true) : null;
        name === "Cancel" ? newButton.onclick = () => confirm(id, false) : null;
        
        button.replaceWith(newButton);           
    }
    
    function ReturnEditButtons(id)
    {
        let OkButton = document.getElementById(`OK_button_${id}`)
        let newEditButton = document.createElement("button");
        newEditButton.textContent = "✎";
        newEditButton.id = `edit_button_${id}`;
        newEditButton.onclick = () =>onEditButton(id);
        
        let deleteButton = document.getElementById(`Cancel_button_${id}`)
        let newDeleteButton = document.createElement("button");
        newDeleteButton.textContent = "❌";
        newDeleteButton.id = `delete_button_${id}`;
        
        
        OkButton.replaceWith(newEditButton);
        deleteButton.replaceWith(newDeleteButton);
    }
    
    function confirm(id, bool)
    {
        let row = document.getElementById(`row_${id}`);
        let cell = row.getElementsByTagName('td');
        
        for (let cellID = 1; cellID < 5; cellID++)
        {
           let input = document.getElementById(`input_row_${id}_cell_${cellID}`);
           let element = cell[cellID].querySelector('div');
           
           if (bool)
           {
             element.innerText = input.value;
           }
           
           input.remove();
           element.style.display = '';
        }        
        
        ReturnEditButtons(id);
    }
    
/*    function onEditClick(id){
        
      let name = document.getElementById(`name_${id}`);
      let nameInput = document.createElement("input");
      nameInput.id = "123t";
      nameInput.innerText = name.innerText;
      let temp_name = name.innerText;
      nameInput.value = name.innerText;
      //name.innerHTML = "";
      name.style.display = "none";
      name.parentNode.appendChild(nameInput);
      
      
      let description = document.getElementById(`description_${id}`);
      let descriptionInput = document.createElement("input");
      let temp_description = description.innerText;
      descriptionInput.value = description.innerText;
      description.innerHTML = "";
      description.appendChild(descriptionInput);
    
    
      let price = document.getElementById(`price_${id}`);
      let priceInput = document.createElement("input");
      let temp_price = price.innerText;
      priceInput.value = price.innerText;
      price.innerHTML = "";
      price.appendChild(priceInput);    
    
    
      let amount = document.getElementById(`amount_${id}`);
      let amountInput = document.createElement("input");
      let temp_amount = amount.innerText;
      amountInput.value = amount.innerText;
      amount.innerHTML = "";
      amount.appendChild(amountInput);
      
      
      let editButton = document.getElementById(`edit_button_${id}`);
      let deleteButton = document.getElementById(`delete_button_${id}`);
      
      let newOkButton =
       document.createElement("button");
      let newCancelButton = document.createElement("button");
      
      newOkButton.textContent = "Ок";
      newCancelButton.textContent = "Cancel";
      
      editButton.replaceWith(newOkButton);
      deleteButton.replaceWith(newCancelButton);

      newOkButton.onclick = function (){
          name.innerText = nameInput.value;
          
          let newText = document.getElementById("123t");
          name.innerText = newText.innerText;
          newText.remove();
          name.style.display = ""

          description.innerText = descriptionInput.value;
          price.innerText = `${priceInput.value} р.`;
          amount.innerText = amountInput.value;
          newOkButton.replaceWith(editButton);
          newCancelButton.replaceWith(deleteButton);
          }
      
      newCancelButton.onclick = function (){
          //name.innerText = temp_name;
          document.getElementById(`123t`).remove();
          //nameInput.remove();
          name.style.display = ""
          description.innerText = temp_description;
          price.innerText = temp_price;
          amount.innerText = temp_amount;
          newOkButton.replaceWith(editButton);
          newCancelButton.replaceWith(deleteButton);
      }
} */
</script>;